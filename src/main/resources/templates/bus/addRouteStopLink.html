<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ë²„ìŠ¤ ë…¸ì„  ì¶”ê°€</title>
</head>
<body>
<h1>ë²„ìŠ¤ ê²½ìœ  ì •ë¥˜ì¥ ì¶”ê°€</h1>

<!-- ğŸ” ê²€ìƒ‰ ê¸°ëŠ¥ ì˜ì—­ -->
<div>
    <label for="searchInput">ì •ë¥˜ì¥ ë˜ëŠ” ë…¸ì„  ê²€ìƒ‰:</label>
    <input type="text" id="searchInput" placeholder="ì˜ˆ: 623, ë™ì„±ë¡œ">
    <button type="button" onclick="searchBus()">ê²€ìƒ‰</button>
</div>

<hr>

<form id="busForm">
    <div id="stopContainer">
         ì •ë¥˜ì¥ ì…ë ¥ ë¸”ëŸ­
        <div class="stop-block">
            <h3>ì •ë¥˜ì¥ 1</h3>
            Route ID: <input type="text" name="routeId"><br>
            BS ID: <input type="text" name="bsId"><br>
            Seq: <input type="number" name="seq"><br>
            Move Dir: <input type="text" name="moveDir"><br>
            X Pos: <input type="number" step="0.000001" name="xpos"><br>
            Y Pos: <input type="number" step="0.000001" name="ypos"><br>
            <hr>
        </div>
    </div>

    <button type="submit">ì¶”ê°€</button>
</form>
<script>
    document.getElementById('busForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const data = Array.from(document.querySelectorAll('.stop-block')).map(block =>
            Array.from(block.querySelectorAll('input')).reduce((obj, input) => {
                obj[input.name] = input.type === 'number' ? parseFloat(input.value) : input.value;
                return obj;
            }, {})
        );

        try {
            const res = await fetch('/api/add/AddRouteStopLink', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                alert('ë²„ìŠ¤ ë…¸ì„ ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                console.log(JSON.stringify(data, null, 2));

                e.target.reset();
            } else {
                alert('ë“±ë¡ ì‹¤íŒ¨! ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        } catch (err) {
            console.error('ì—ëŸ¬ ë°œìƒ:', err);
            alert('ì—ëŸ¬ ë°œìƒ! ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.');
        }
    });
</script>

<script>

    function searchBus() {
        const query = document.getElementById('searchInput').value;
        if (!query.trim()) {
            alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }
        fetch(`/api/bus/searchBSorBN?keyword=${encodeURIComponent(query)}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json()) // ë°›ì•„ì˜¨ jsonì„ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•œ jsë¡œ ë˜ ë³€í™˜ (ê±°ì˜ í•„ìˆ˜)
            .then(data => {
                console.log("data2 : ", data);
            })
            .catch(error => console.error('ì˜¤ë¥˜ ë°œìƒ:', error));
    }

</script>

</body>
</html>
