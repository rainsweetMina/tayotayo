<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{admin_page_test/admin_layout/layout.html}" lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê¸¸ì°¾ê¸° í›„ë³´ ì •ë¥˜ì¥ íƒìƒ‰ ê±°ë¦¬ ì„¤ì •</title>

</head>

<div layout:fragment="content" style="">

  <style>


  </style>

<body>

<h2>ğŸ§­ ê¸¸ì°¾ê¸° ì„¤ì •: í›„ë³´ ì •ë¥˜ì¥ íƒìƒ‰ ë°˜ê²½ ë° ì •ë¥˜ì¥ ë³„ ì†Œìš”ì‹œê°„ ì„¤ì •</h2>

<form id="settingsForm">
  <label for="startDistance">ì¶œë°œì§€ ë°˜ê²½ (ë¯¸í„°)</label>
  <input type="number" id="startDistance" name="startDistance" min="100" max="2000" required>

  <label for="endDistance">ë„ì°©ì§€ ë°˜ê²½ (ë¯¸í„°)</label>
  <input type="number" id="endDistance" name="endDistance"  min="100" max="2000" required><br>

  <label for="timeFactor">ì •ë¥˜ì¥ë‹¹ ì˜ˆìƒ ì‹œê°„ (ë¶„)</label>
  <input type="number" id="timeFactor" name="timeFactor" min="1" max="10" step="0.1" required><br>
  <p>* ì„¤ì • ë³„ ê¸°ë³¸ê°’ì€ ì¶œë°œì§€ 300ë¯¸í„° ë„ì°©ì§€ 300ë¯¸í„° ì •ë¥˜ì¥ë‹¹ ì˜ˆìƒ ì‹œê°„ì€ 2.5ë¶„</p>

  <hr>

  <button type="submit">ğŸ’¾ ì €ì¥</button>
</form>



<p id="status" style="margin-top:1rem; color: green;"></p>

<script>
  document.getElementById("settingsForm").addEventListener("submit", async (e) => {
    e.preventDefault();


    const startDistance = document.getElementById("startDistance").value;
    const endDistance = document.getElementById("endDistance").value;
    const timeFactor = document.getElementById("timeFactor").value;

    const payload = {
      startDistance: parseInt(startDistance),
      endDistance: parseInt(endDistance),
      timeFactor: parseFloat(timeFactor)
    };

    try {
      const res = await fetch("/api/bus/path-settings", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        document.getElementById("status").textContent = "âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.";
      } else {
        document.getElementById("status").textContent = "âŒ ì €ì¥ ì‹¤íŒ¨";
      }
    } catch (err) {
      console.error(err);
      document.getElementById("status").textContent = "âŒ ì˜¤ë¥˜ ë°œìƒ";
    }
  });
</script>
<script>
  window.addEventListener("DOMContentLoaded", async () => {
    try {
      const res = await fetch("/api/bus/path-settings");
      if (res.ok) {
        const data = await res.json();
        document.getElementById("startDistance").value = data.startDistance;
        document.getElementById("endDistance").value = data.endDistance;
        document.getElementById("timeFactor").value = data.timeFactor;
      } else {
        console.warn("ê¸°ë³¸ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
      }
    } catch (e) {
      console.error("ê¸°ë³¸ ì„¤ì • ë¡œë”© ì˜¤ë¥˜:", e);
    }
  });
</script>
</body>
</div>
</html>
