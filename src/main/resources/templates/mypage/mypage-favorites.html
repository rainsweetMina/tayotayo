<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì¦ê²¨ì°¾ê¸°</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .favorites { max-width: 600px; margin: 0 auto; }
        .favorite-item {
            display: flex; justify-content: space-between;
            padding: 10px; border-bottom: 1px solid #ccc;
        }
        .favorite-item span { font-weight: bold; }
        .add-form { margin-top: 20px; display: flex; gap: 10px; }
        h2 { border-bottom: 2px solid #333; padding-bottom: 5px; margin-top: 40px; }
    </style>
</head>
<body>
<div class="favorites">
    <h1>ğŸš ì¦ê²¨ì°¾ê¸° ê´€ë¦¬</h1>

    <h2>ğŸ“ ì •ë¥˜ì¥ ì¦ê²¨ì°¾ê¸°</h2>
    <div id="bus-stop-list"></div>
    <div class="add-form">
        <input type="text" id="busStopId" placeholder="ì •ë¥˜ì¥ ID ì…ë ¥">
        <button onclick="addBusStop()">ì •ë¥˜ì¥ ì¶”ê°€</button>
    </div>

    <h2>ğŸšŒ ë…¸ì„  ì¦ê²¨ì°¾ê¸°</h2>
    <div id="route-list"></div>
    <div class="add-form">
        <input type="text" id="routeId" placeholder="ë…¸ì„  ID ì…ë ¥">
        <button onclick="addRoute()">ë…¸ì„  ì¶”ê°€</button>
    </div>
</div>

<script th:inline="javascript">
    const userId = /*[[${userId}]]*/ "";
    const busStopList = document.getElementById('bus-stop-list');
    const routeList = document.getElementById('route-list');

    if (!userId || userId === "") {
        console.warn("âš  userIdê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.");
    }

    function loadFavorites() {
        busStopList.innerHTML = '';
        routeList.innerHTML = '';

        axios.get(`/api/mypage/favorite/bus-stop?userId=${userId}`)
            .then(res => {
                (res.data || []).forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'favorite-item';
                    div.innerHTML = `
                        <div><span>ì •ë¥˜ì¥</span> | ${item.bsId}</div>
                        <button onclick="removeBusStop('${item.bsId}')">ì‚­ì œ</button>
                    `;
                    busStopList.appendChild(div);
                });
            })
            .catch(err => {
                console.error("ì •ë¥˜ì¥ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:", err);
                alert('ì •ë¥˜ì¥ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });

        axios.get(`/api/mypage/favorite/route?userId=${userId}`)
            .then(res => {
                (res.data || []).forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'favorite-item';
                    div.innerHTML = `
                        <div><span>ë…¸ì„ </span> | ${item.routeId}</div>
                        <button onclick="removeRoute('${item.routeId}')">ì‚­ì œ</button>
                    `;
                    routeList.appendChild(div);
                });
            })
            .catch(err => {
                console.error("ë…¸ì„  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:", err);
                alert('ë…¸ì„  ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
    }

    function addBusStop() {
        const bsId = document.getElementById('busStopId').value.trim();
        if (!bsId) return alert('ì •ë¥˜ì¥ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

        axios.post(`/api/mypage/favorite/bus-stop?userId=${userId}&bsId=${bsId}`)
            .then(() => {
                alert('ì •ë¥˜ì¥ ì¶”ê°€ ì™„ë£Œ!');
                document.getElementById('busStopId').value = '';
                loadFavorites();
            })
            .catch(err => {
                console.error(err);
                alert(err.response?.data || 'ì •ë¥˜ì¥ ì¶”ê°€ ì‹¤íŒ¨!');
            });
    }

    function addRoute() {
        const routeId = document.getElementById('routeId').value.trim();
        if (!routeId) return alert('ë…¸ì„  IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

        axios.post(`/api/mypage/favorite/route?userId=${userId}&routeId=${routeId}`)
            .then(() => {
                alert('ë…¸ì„  ì¶”ê°€ ì™„ë£Œ!');
                document.getElementById('routeId').value = '';
                loadFavorites();
            })
            .catch(err => {
                console.error(err);
                alert(err.response?.data || 'ë…¸ì„  ì¶”ê°€ ì‹¤íŒ¨!');
            });
    }

    function removeBusStop(bsId) {
        axios.delete(`/api/mypage/favorite/bus-stop`, {
            params: { userId: userId, bsId: bsId }
        })
            .then(() => loadFavorites())
            .catch(err => {
                console.error(err);
                alert('ì •ë¥˜ì¥ ì‚­ì œ ì‹¤íŒ¨!');
            });
    }

    function removeRoute(routeId) {
        axios.delete(`/api/mypage/favorite/route`, {
            params: { userId: userId, routeId: routeId }
        })
            .then(() => loadFavorites())
            .catch(err => {
                console.error(err);
                alert('ë…¸ì„  ì‚­ì œ ì‹¤íŒ¨!');
            });
    }

    document.addEventListener('DOMContentLoaded', loadFavorites);
</script>
</body>
</html>
